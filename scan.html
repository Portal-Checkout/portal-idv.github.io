<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://blog.minhazav.dev/assets/research/html5qrcode/html5-qrcode.min.v2.3.0.js"></script>
</head>

<body>
    <select id="cameraSelect">
        <option>1</option>
    </select>
    <div id="reader" style="width: 100%; max-width: 400px; margin: auto;"></div>
    <p>Scanned Code: <span id="result"></span></p>

    <script>
        let selectedDeviceId = null;

        async function getCameras() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === "videoinput");
                const select = document.getElementById("cameraSelect");
                select.innerHTML = "";

                videoDevices.forEach(device => {
                    let option = document.createElement("option");
                    option.value = device.deviceId;
                    option.text = device.label || "Camera " + select.length + 1;
                    select.appendChild(option);
                });

                if (videoDevices.length > 0) {
                    selectedDeviceId = videoDevices[0].deviceId;
                    startScanning();
                }
            } catch (err) {
                console.error("Error fetching camera devices:", err);
                window.ReactNativeWebView.postMessage(err);
            }
        }

        function startScanning() {
            if (!selectedDeviceId) return;

            const html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start(
                selectedDeviceId,
                { fps: 10, qrbox: 250 },
                (decodedText, decodedResult) => {
                    document.getElementById("result").innerText = decodedText;
                    window.ReactNativeWebView.postMessage(decodedText);
                },
                (errorMessage) => {
                    console.warn("QR Scan Error:", errorMessage);
                }
            ).catch(err => console.error("QR Scanner error:", err));
        }

        document.getElementById("cameraSelect").addEventListener("change", function () {
            selectedDeviceId = this.value;
            startScanning();
        });

        getCameras();
    </script>
</body>

</html>